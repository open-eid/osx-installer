<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!--
https://developer.apple.com/library/mac/documentation/DeveloperTools/Reference/DistributionDefinitionRef/
https://developer.apple.com/library/mac/documentation/DeveloperTools/Reference/InstallerJavaScriptRef/
-->
<installer-gui-script minSpecVersion="2">
    <title>SU_TITLE</title>
    <allowed-os-versions>
        <os-version min="10.10"/>
    </allowed-os-versions>
    <options customize="allow" require-scripts="false" rootVolumeOnly="true" hostArchitectures="x86_64"/>
    <!--domains enable_anywhere="false" enable_currentUserHome="false" enable_localSystem="true"/-->
    <background file="background.png" alignment="bottomleft" mime-type="image/png" scaling="none" />
    <welcome language="en" mime-type="text/html"><![CDATA[<html><body><br />
<p style="margin: 0px; font: 13px 'Lucida Grande'">You will be guided through the steps necessary to install this software.</p></body></html>]]></welcome>
    <welcome language="et" mime-type="text/html"><![CDATA[<html><body><br />
<p style="margin: 0px; font: 13px 'Lucida Grande'">Järgnevad juhised tarkvara installeerimiseks.</p></body></html>]]></welcome>
    <welcome language="ru" mime-type="text/html"><![CDATA[<html><body><br />
<p style="margin: 0px; font: 13px 'Lucida Grande'">Вам будут предложены шаги по установке данного ПО.</p></body></html>]]></welcome>
    <conclusion language="en" mime-type="text/html"><![CDATA[<html><body>
<p style="margin: 0px; font: 14px 'Lucida Grande'; color: #996C0B"><b>NB! Changes in new version</b><br />
In order to use ID-card in e-services <b>make sure that the extension is installed and enabled</b>.<br /><ol>
<li style="margin: 0px; font: 12px 'Lucida Grande'">Open browser</li>
<li style="margin: 0px; font: 12px 'Lucida Grande'">Go to <b>Extensions</b></li>
<li style="margin: 0px; font: 12px 'Lucida Grande'">Enable <b>Web eID</b></li>
</ol></p>
<p style="margin: 0px; font: 12px 'Lucida Grande'">The guide can be found <a href="https://www.id.ee/en/article/configuring-browsers-for-using-id-card/">here</a>.</p><br /><br /><br />
<p style="margin: 0px; font: 12px 'Lucida Grande'">Additional software is available in App Store:<br /><ul>
<li style="margin: 0px; font: 12px 'Lucida Grande'"><a href="macappstore://itunes.apple.com/ee/developer/ria/id556524921?mt=12">DigiDoc4 client</a> - digital signing, encryption and ID-card management</li>
<li style="margin: 0px; font: 12px 'Lucida Grande'"><a href="macappstore://itunes.apple.com/ee/developer/ria/id556524921?mt=12">Web eID</a> - ID-card support in Safari <b>(required)</b></li>
</ul></p></body></html>]]></conclusion>
    <conclusion language="et" mime-type="text/html"><![CDATA[<html><body>
<p style="margin: 0px; font: 14px 'Lucida Grande'; color: #996C0B"><b>NB! Muudatused uues versioonis</b><br />
ID-kaardi kasutamiseks e-teenustes <b>veendu, et laiendus on paigaldatud ning aktiveeritud</b>.<br /><ol>
<li style="margin: 0px; font: 12px 'Lucida Grande'">Ava veebilehitseja</li>
<li style="margin: 0px; font: 12px 'Lucida Grande'">Ava menüüst <b>Laiendused</b></li>
<li style="margin: 0px; font: 12px 'Lucida Grande'">Luba <b>Web eID<b/></li>
</ol></p>
<p style="margin: 0px; font: 12px 'Lucida Grande'">Juhend on leitav <a href="https://www.id.ee/artikkel/veebibrauserite-seadistamine-id-kaardi-kasutamiseks/">siit</a>.</p><br /><br /><br />
<p style="margin: 0px; font: 12px 'Lucida Grande'">Lisaks tuleb App Store'ist arvutisse paigaldada:<br /><ul>
<li style="margin: 0px; font: 12px 'Lucida Grande'"><a href="macappstore://itunes.apple.com/ee/developer/ria/id556524921?mt=12">DigiDoc4 klient</a> - digitaalne allkirjastamine, krüpteerimine ja ID-kaardi haldus</li>
<li style="margin: 0px; font: 12px 'Lucida Grande'"><a href="macappstore://itunes.apple.com/ee/developer/ria/id556524921?mt=12">Web eID</a> - ID-kaardi tugi Safaris <b>(kohustuslik)</b></li>
</ul></p></body></html>]]></conclusion>
    <conclusion language="ru" mime-type="text/html"><![CDATA[<html><body>
<p style="margin: 0px; font: 14px 'Lucida Grande'; color: #996C0B"><b>NB! Изменения в новой версии</b><br />
Для использования ID-карты в э-услугах, <b>убедитесь, что расширение установлено и включено</b>.<br /><ol>
<li style="margin: 0px; font: 12px 'Lucida Grande'">Открой интерет браузер</li>
<li style="margin: 0px; font: 12px 'Lucida Grande'">Открой в меню <b>Расширения</b></li>
<li style="margin: 0px; font: 12px 'Lucida Grande'">Разреши <b>Web eID</b></li>
</ol></p>
<p style="margin: 0px; font: 12px 'Lucida Grande'">Руководство можно найти <a href="https://www.id.ee/ru/artikkel/nastrojka-veb-brauzerov-dlya-ispolzovaniya-id-karty/">здесь</a>.</p><br /><br /><br />
<p style="margin: 0px; font: 12px 'Lucida Grande'">Необходимо также загрузить из магазина приложений App Store и установить на компьютер:<br /><ul>
<li style="margin: 0px; font: 12px 'Lucida Grande'"><a href="macappstore://itunes.apple.com/ee/developer/ria/id556524921?mt=12">DigiDoc4 клиент</a> - цифровая подпись, шифрование и управление ID-картой</li>
<li style="margin: 0px; font: 12px 'Lucida Grande'"><a href="macappstore://itunes.apple.com/ee/developer/ria/id556524921?mt=12">Web eID</a> - Поддержка ID-карт в Safari <b>(обязательна)</b></li>
</ul></p></body></html>]]></conclusion>
    <localization>
        <strings language="en">
<![CDATA[
"SU_TITLE" = "eID Software";
"SU_ERROR" = "Error";
"SU_1014" = "macOS must be 10.14 or newer.";
"SU_BASE" = "Base components";
"SU_FIREFOX" = "Firefox authentication and signing support";
"SU_CHROME" = "Chrome authentication and signing support";
"SU_CHROME_POLICY" = "Chrome extension will be activated automatically";
"SU_DRIVERS" = "Estonian ID-card support";
]]>
        </strings>
        <strings language="et">
<![CDATA[
"SU_TITLE" = "eID tarkvara";
"SU_ERROR" = "Viga";
"SU_1014" = "macOS peab olema 10.14 või uuem.";
"SU_BASE" = "Baas komponendid";
"SU_FIREFOX" = "Firefox isikutuvastamise ja allkirjastamise tugi";
"SU_CHROME" = "Chrome isikutuvastamise ja allkirjastamise tugi";
"SU_CHROME_POLICY" = "Chrome laiendus aktiveeritakse automaatselt";
"SU_DRIVERS" = "Eesti ID-kaardi tugi";
]]>
        </strings>
        <strings language="ru">
<![CDATA[
"SU_TITLE" = "eID программное обеспечение";
"SU_ERROR" = "Ошибка";
"SU_1014" = "Версия macOS должна быть 10.14 или новее.";
"SU_BASE" = "Базовые компоненты";
"SU_FIREFOX" = "Поддержка аутентификации и электронной подписи в Firefox";
"SU_CHROME" = "Поддержка аутентификации и электронной подписи в Chrome";
"SU_CHROME_POLICY" = "Плагин для Chrome активируется автоматически";
"SU_DRIVERS" = "Поддержка эстонской ID-карты";
]]>
        </strings>
    </localization>
    <installation-check script="pm_install_check();"/>
    <script>
<![CDATA[
function pm_install_check() {
  if(system.compareVersions(system.version.ProductVersion, '10.14.0') < 0) {
    my.result.title = system.localizedString('SU_ERROR');
    my.result.message = system.localizedString('SU_1014');
    my.result.type = 'Fatal';
    return false;
  }
  return true;
}

function pm_firefox_selected() {
  return my.target.receiptForIdentifier("ee.ria.open-eid") == null ||
    (my.target.receiptForIdentifier("ee.ria.firefox-pkcs11-loader") != null ||
     my.target.receiptForIdentifier("ee.ria.token-signing-firefox") != null ||
     my.target.receiptForIdentifier("eu.web-eid.web-eid-firefox") != null);
}

function pm_chrome_selected() {
  return my.target.receiptForIdentifier("ee.ria.open-eid") == null ||
    (my.target.receiptForIdentifier("ee.ria.chrome-token-signing") != null ||
     my.target.receiptForIdentifier("ee.ria.token-signing-chrome") != null ||
     my.target.receiptForIdentifier("eu.web-eid.web-eid-chrome") != null);
}

function pm_chrome_policy_visible() {
  return system.compareVersions(system.version.ProductVersion, '10.16') < 0;
}

function pm_chrome_policy_selected() {
  return pm_chrome_policy_visible() && pm_chrome_selected() &&
    my.target.receiptForIdentifier("eu.web-eid.web-eid-chrome-policy") != null;
}

function pm_drivers_selected() {
  return my.target.receiptForIdentifier("ee.ria.open-eid") == null ||
    (my.target.receiptForIdentifier("ee.ria.esteid-ctk-tokend") != null ||
     my.target.receiptForIdentifier("org.opensc-project.mac") != null);
}
]]>
    </script>
    <choices-outline>
        <line choice="default"/>
        <line choice="native"/>
        <line choice="firefox"/>
        <line choice="chrome"/>
        <line choice="chrome_policy"/>
        <line choice="drivers"/>
    </choices-outline>
    <choice id="default" title="SU_BASE" start_enabled="false" visible="false">
        <pkg-ref id="ee.ria.updater">updater.pkg</pkg-ref>
        <pkg-ref id="ee.ria.open-eid">Open-EID.pkg</pkg-ref>
    </choice>
    <choice id="native" title="SU_BASE" visible="false"
            start_enabled="choices.chrome.selected || choices.firefox.selected"
            selected="choices.chrome.selected || choices.firefox.selected">
        <pkg-ref id="eu.web-eid.web-eid">web-eid-native.pkg</pkg-ref>
    </choice>
    <choice id="firefox" title="SU_FIREFOX" description="SU_FIREFOX" start_selected="pm_firefox_selected()">
        <pkg-ref id="ee.ria.firefox-pkcs11-loader">firefox-pkcs11-loader.pkg</pkg-ref>
        <pkg-ref id="eu.web-eid.web-eid-firefox">web-eid-firefox.pkg</pkg-ref>
    </choice>
    <choice id="chrome" title="SU_CHROME" description="SU_CHROME" start_selected="pm_chrome_selected()">
        <pkg-ref id="eu.web-eid.web-eid-chrome">web-eid-chrome.pkg</pkg-ref>
    </choice>
    <choice id="chrome_policy" title="SU_CHROME_POLICY" description="SU_CHROME_POLICY"
            start_selected="pm_chrome_policy_selected()"
            start_enabled="pm_chrome_selected()"
            start_visible="pm_chrome_policy_visible()"
            enabled="choices.chrome.selected"
            selected="choices.chrome.selected ? choices.chrome_policy.selected : false">
        <pkg-ref id="eu.web-eid.web-eid-chrome-policy">web-eid-chrome-policy.pkg</pkg-ref>
    </choice>
    <choice id="drivers" title="SU_DRIVERS" description="SU_DRIVERS" start_selected="pm_drivers_selected()">
        <pkg-ref id="org.opensc-project.mac">opensc.pkg</pkg-ref>
        <pkg-ref id="ee.ria.esteid-ctk-tokend">esteid-ctk-tokend.pkg</pkg-ref>
    </choice>
</installer-gui-script>
